<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FourmizHome</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg:#FAF8F0;  
      --ink:#2B2B2B;   
      --title:#7B1E1E; 
      --accent:#C5A047; 
    }
    body{background:var(--bg);color:var(--ink)}
    .navbar{background:var(--ink)}
    .navbar-brand{color:#fff !important;font-weight:800;letter-spacing:.3px}
    .nav-pills .nav-link{color:#ffffffcc;border-radius:999px}
    .nav-pills .nav-link.active,
    .btn-accent{background:var(--accent);color:var(--ink);border:none;font-weight:700}

    footer{background:var(--ink);color:#fff;}
    footer a{color:#ffffffb3;text-decoration:none;}
    footer a:hover{color:#fff;}
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
            <img src="assets/logo.png" alt="" height="52" class="d-inline-block align-text-top">
            <span class="fs-3 lh-1">FourmizHome</span>
        </a>

      <button class="navbar-toggler bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div id="navMain" class="collapse navbar-collapse">
        <a class="btn btn-accent rounded-pill px-3 ms-lg-2" href="#">Espace Hôte</a>
      </div>
    </div>
  </nav>

    <main class="container py-5">
    <section class="container my-5 text-center">
      <p class="text-muted mb-2">Bienvenue,</p>
      <h1 class="fw-bold mb-4" style="color:var(--title)">Cher Hôte</h1>

      <form id="loginForm" class="mx-auto text-start" style="max-width:420px">
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input id="email" type="email" class="form-control input-pill" name="email" required autocomplete="email">
        </div>

        <div class="mb-2 pwd-wrap">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="form-control input-pill" name="password" required autocomplete="current-password" id="pwd">
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="remember">
            <label class="form-check-label form-hint" for="remember">
              Rester connecté
            </label>
          </div>
        </div>

        <div class="text-center d-grid gap-2">
          <button type="submit" class="btn btn-accent rounded-pill px-4" id="btnLogin">
            <span class="spinner-border spinner-border-sm me-2 d-none" id="spLogin" role="status" aria-hidden="true"></span>
            Se connecter
          </button>
          <div class="text-danger small text-center" id="errLogin" role="alert" aria-live="polite"></div>
        </div>
      </form>
    </section>
  </main>

  <footer class="mt-5 py-4">
    <div class="container d-flex flex-wrap justify-content-between align-items-center">
      <small>© 2025 FourmizHome, Inc.</small>

      <div class="d-flex gap-3 justify-content-center flex-grow-1">
        <a href="conditions.html">Conditions</a>
        <a href="confidentialite.html">Confidentialité</a>
        <a href="cookies.html">Cookies</a>
      </div>

      <div class="d-flex gap-3">
        <a href="https://facebook.com" target="_blank"><i class="bi bi-facebook fs-5"></i></a>
        <a href="https://instagram.com" target="_blank"><i class="bi bi-instagram fs-5"></i></a>
      </div>
    </div>
  </footer>

 <script>
  const API_LOGIN = 'http://localhost:3000/api/v1/auth/login';  

  // ====== UTILITAIRES (gestion de laffichage plus simple) ======
  const show = (el) => el.classList.remove('d-none');
  const hide = (el) => el.classList.add('d-none');

  // ====== TOGGLE MOT DE PASSE (œil)
  (function pwdToggle(){
    const pwd  = document.getElementById('pwd');
    const wrap = pwd.closest('.pwd-wrap') || pwd.parentElement;
    const btn  = document.createElement('button');
    btn.type = 'button';
    btn.id   = 'togglePwd';
    btn.className = 'btn btn-sm btn-outline-secondary position-absolute end-0 me-2 mt-1';
    btn.style.transform = 'translateY(6px)';
    btn.innerHTML = '<i class="bi bi-eye"></i>';
    wrap.style.position = 'relative';
    wrap.appendChild(btn);
    btn.addEventListener('click', ()=>{
      const show = pwd.type === 'password';
      pwd.type = show ? 'text' : 'password';
      btn.innerHTML = show ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
      pwd.focus();
    });
  })();

  document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const btn = document.getElementById('btnLogin');
  const sp  = document.getElementById('spLogin');
  const err = document.getElementById('errLogin');
  const emailInput = document.getElementById('email');

  btn.disabled = true; sp.classList.remove('d-none'); err.textContent = '';

    const res = await fetch(API_LOGIN, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body : JSON.stringify( {
        "email": emailInput.value,
        "password": pwd.value
      })
    });

    const data = await res.json().catch(()=> ({}));
    
    // Stockage token si renvoyé
    if (data.token) {
      const remember = document.getElementById('remember').checked;
      (remember ? localStorage : sessionStorage).setItem('fh_token', data.token);
    }

    window.location.href = '/profil.html';
});

  // ====== Helper pour appels protégés avec token stocké 
  async function authFetch(url, options = {}) {
    const token = localStorage.getItem('fh_token') || sessionStorage.getItem('fh_token');
    const headers = new Headers(options.headers || {});
    if (token) headers.set('Authorization', 'Bearer ' + token);
    return fetch(url, { ...options, headers });
  }
</script>
</script>
</body>
</html>
